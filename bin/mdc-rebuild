#!/usr/bin/env bash
set -e

# First find out if this was called from symlink,
# then find the real path of parent directory.
# This is needed because macOS does not have GNU realpath.
thisfile=$( readlink "${BASH_SOURCE[0]}" ) || thisfile="${BASH_SOURCE[0]}"
MDC_BASEDIR="$( cd "$( dirname "$thisfile" )/../" && pwd -P )"
export MDC_BASEDIR="${MDC_BASEDIR}"

$MDC_BASEDIR/bin/mdc down

configfilename="mdc-compose.yml"
if [ -f $configfilename ]; then
    rm $configfilename
fi

$MDC_BASEDIR/bin/mdc up -d

$MDC_BASEDIR/bin/mdc exec db bash mdc_db_wait.sh
